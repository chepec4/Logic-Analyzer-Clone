name: Build C4 Analyzer (Logic Pro Edition)

# Se ejecuta al hacer push o manualmente desde la pesta帽a Actions
on: [push, workflow_dispatch]

jobs:
  build-windows:
    name: Compilar en Windows (MinGW x64)
    runs-on: windows-latest
    
    steps:
    # 1. Bajamos el c贸digo del repositorio
    - name:  Checkout del C贸digo
      uses: actions/checkout@v4

    # 2. Preparamos el compilador GCC 12 (MinGW)
    # Usamos la versi贸n 12.2.0 que es compatible con las correcciones de sintaxis que hicimos
    - name: 锔 Instalar MinGW
      uses: egor-tensin/setup-mingw@v2
      with:
        platform: x64
        version: 12.2.0

    # 3. Compilaci贸n
    # Ejecutamos el Makefile que est谩 dentro de la carpeta 'src'
    # El Makefile est谩 configurado para soltar el DLL en la ra铆z del proyecto (../C4Analyzer.dll)
    - name:  Compilar C4 Analyzer
      working-directory: src
      run: mingw32-make

    # 4. Verificaci贸n de Resultados
    # Listamos el directorio ra铆z para confirmar visualmente en el log que el DLL existe.
    # Usamos 'dir' nativo de Windows.
    - name:  Verificar Existencia del DLL
      run: dir C4Analyzer.dll
      shell: cmd

    # 5. Empaquetado
    # Subimos el DLL resultante para que lo puedas descargar.
    # 'if-no-files-found: error' detendr谩 el proceso en rojo si el DLL no se cre贸.
    - name:  Subir Artefacto
      uses: actions/upload-artifact@v4
      with:
        name: C4Analyzer-VST
        path: C4Analyzer.dll
        if-no-files-found: error
